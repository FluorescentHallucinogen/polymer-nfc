<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="polymer-nfc">

  <script>
    /**
     * `polymer-nfc`
     * Web Component for NFC reading and writing using WebNFC W3C Draft Standard.  
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class PolymerNfc extends Polymer.Element {
      static get is() { return 'polymer-nfc'; }
      static get properties() {
        return {
          watch: {
            type: Boolean,
            reflectToAttribute: true,
            notify: true,
            value: false,
            observer: '_watchChanged'
          },
          data: {
            type: Object,
            notify: true,
            reflectToAttribute: true,
            value: function() {
              return {};
            }
          }
        };
      }

      readOn() {
        this.watch = true;
      }

      readOff() {
        this.watch = false;
      }

      _watchChanged(watch) {
        if (watch) {
          navigator.nfc.watch(message => {
            if (this.write) {
              navigator.nfc.push({
                records: [
                  {
                    recordType: "json",
                    mediaType: "application/json",
                    data: this.data
                  }
                ]}
              )
              .then( () => {
                this.fresh = false;
              }).catch( (error) => {
                
              });
            }else{
              for (let record of message.records) {
                this.data = record.data;
              }
            }
        }, { mode: "any", recordType: "json", passive: true })
          .then(() => {

          }).catch((error) => {
          
          }); 
        } else {
          this.data = {};
        }
      }
    }

    window.customElements.define(PolymerNfc.is, PolymerNfc);
  </script>
</dom-module>
